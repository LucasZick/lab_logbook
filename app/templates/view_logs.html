{% extends "base.html" %}

{% block content %}
    <style>
        .list-group-item.active { background-color: #2c3e50; border-color: #2c3e50; }
        .log-content { white-space: pre-wrap; word-wrap: break-word; }
        
        /* --- Estilos da Nova Lista Expansível --- */
        .log-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            overflow: hidden; /* Garante que os cantos fiquem arredondados */
        }
        .log-summary {
            background-color: #fff;
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .log-summary:hover {
            background-color: #f8f9fa;
        }
        .log-details {
            background-color: #f8f9fa;
            padding: 1.25rem;
            border-top: 1px solid #dee2e6;
        }
        /* Rotaciona o ícone de seta quando expandido */
        .log-summary[aria-expanded="true"] .chevron-icon {
            transform: rotate(180deg);
        }
        .chevron-icon {
            transition: transform 0.2s ease-in-out;
        }
    </style>

    <div class="content-card">
        <h3><i class="fas fa-user-graduate"></i> Diário de Bordo de: <strong>{{ student.username }}</strong></h3>
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm btn-outline-secondary mt-2"><i class="fas fa-arrow-left"></i> Voltar ao Painel</a>
        <hr>
        <div class="row mt-4">
            <!-- Coluna da Esquerda: Navegação dos Meses -->
            <div class="col-md-3">
                {% if available_months %}
                <div class="list-group">
                    {% for month_data in available_months %}
                        <a href="{{ url_for('main.view_logs', student_id=student.id, ano=month_data.year, mes=month_data.month) }}" 
                           class="list-group-item list-group-item-action {% if month_data.name == current_month_name %}active{% endif %}">
                           {{ month_data.name }}
                        </a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Coluna da Direita: LISTA COMPACTA EXPANSÍVEL -->
            <div class="col-md-9">
                <h4>Exibindo registros de: {{ current_month_name }}</h4>
                <hr>
                {% if logs_to_display %}
                    <div class="d-grid gap-2">
                        {% for log in logs_to_display %}
                        <div class="log-item">
                            <!-- A LINHA RESUMIDA E CLICÁVEL -->
                            <div class="log-summary d-flex justify-content-between align-items-center" data-bs-toggle="collapse" data-bs-target="#log-details-{{ log.id }}" aria-expanded="false">
                                <div class="d-flex align-items-center">
                                    <strong class="text-primary">{{ log.entry_date.strftime('%d/%m/%Y') }}</strong>
                                    <span class="ms-3">{{ log.project }}</span>
                                    
                                    <!-- PONTO DE AVISO ADICIONADO -->
                                    {% if log.observations %}
                                        <i class="fas fa-exclamation-triangle text-warning ms-2" title="Possui observações"></i>
                                    {% endif %}
                                </div>
                                <button class="btn btn-sm btn-light">
                                    Ver Detalhes <i class="fas fa-chevron-down chevron-icon"></i>
                                </button>
                            </div>
                            <!-- O CONTEÚDO DETALHADO E OCULTO -->
                            <div class="collapse" id="log-details-{{ log.id }}">
                                <div class="log-details">
                                    <p><strong><i class="fas fa-tasks text-primary"></i> Tarefas Realizadas:</strong></p>
                                    <p class="log-content">{{ log.tasks_completed }}</p>
                                    
                                    {% if log.observations %}
                                        <p><strong><i class="fas fa-lightbulb text-primary"></i> Observações:</strong></p>
                                        <p class="log-content">{{ log.observations }}</p>
                                    {% endif %}
                                    
                                    <p><strong><i class="fas fa-arrow-right text-primary"></i> Próximos Passos:</strong></p>
                                    <p class="log-content">{{ log.next_steps }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-center text-muted mt-5">Nenhum registro encontrado para este período.</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

